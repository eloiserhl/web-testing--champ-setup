# management/commands/load_championship_demo.py
from django.core.management.base import BaseCommand
from app.models import (
    Championship, Round, Race, Class, RaceClass,
    ClassSchedule, PricingTier, ClassPricing
)
from datetime import date

class Command(BaseCommand):
    help = "Load example championship structure with related data"

    def handle(self, *args, **kwargs):
        # Clear existing data
        Championship.objects.all().delete()
        Class.objects.all().delete()

        # Create Championship
        champ = Championship.objects.create(name="2025 Spring Championship")

        # Create Rounds
        round1 = Round.objects.create(name="Opener", date=date(2025, 4, 1), championship=champ)
        round2 = Round.objects.create(name="Final Showdown", date=date(2025, 5, 15), championship=champ)

        # Create Classes
        junior = Class.objects.create(name="Junior", base_price=30.00)
        senior = Class.objects.create(name="Senior", base_price=40.00)
        expert = Class.objects.create(name="Expert", base_price=50.00)

        # Create Races
        race_a = Race.objects.create(name="Junior Heat", round=round1)
        race_b = Race.objects.create(name="Senior Sprint", round=round1)
        race_c = Race.objects.create(name="Final Heat", round=round2)

        # Assign Race Classes
        RaceClass.objects.create(race=race_a, rider_class=junior)
        RaceClass.objects.create(race=race_b, rider_class=senior)
        RaceClass.objects.create(race=race_c, rider_class=expert)

        # Schedule Classes
        ClassSchedule.objects.create(round=round1, rider_class=junior)
        ClassSchedule.objects.create(round=round1, rider_class=senior)
        ClassSchedule.objects.create(round=round2, rider_class=senior)
        ClassSchedule.objects.create(round=round2, rider_class=expert)

        # Create Pricing Tiers
        tier1a = PricingTier.objects.create(name="Early Bird", round=round1, start_date=date(2025, 3, 1), end_date=date(2025, 3, 15))
        tier1b = PricingTier.objects.create(name="Standard", round=round1, start_date=date(2025, 3, 16), end_date=date(2025, 3, 31))
        tier1c = PricingTier.objects.create(name="Late", round=round1, start_date=date(2025, 4, 1), end_date=date(2025, 4, 7))

        tier2a = PricingTier.objects.create(name="Early Bird", round=round2, start_date=date(2025, 4, 10), end_date=date(2025, 4, 25))
        tier2b = PricingTier.objects.create(name="Standard", round=round2, start_date=date(2025, 4, 26), end_date=date(2025, 5, 10))

        # Class Pricing - Round 1
        ClassPricing.objects.create(pricing_tier=tier1a, rider_class=junior, price=25.00)
        ClassPricing.objects.create(pricing_tier=tier1a, rider_class=senior, price=35.00)
        ClassPricing.objects.create(pricing_tier=tier1b, rider_class=junior, price=30.00)
        ClassPricing.objects.create(pricing_tier=tier1b, rider_class=senior, price=40.00)
        ClassPricing.objects.create(pricing_tier=tier1c, rider_class=junior, price=35.00)
        ClassPricing.objects.create(pricing_tier=tier1c, rider_class=senior, price=45.00)

        # Class Pricing - Round 2
        ClassPricing.objects.create(pricing_tier=tier2a, rider_class=senior, price=38.00)
        ClassPricing.objects.create(pricing_tier=tier2a, rider_class=expert, price=45.00)
        ClassPricing.objects.create(pricing_tier=tier2b, rider_class=senior, price=43.00)
        ClassPricing.objects.create(pricing_tier=tier2b, rider_class=expert, price=50.00)

        self.stdout.write(self.style.SUCCESS('Demo championship data loaded successfully.'))
